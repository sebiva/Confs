#!/bin/bash



# Tmux Plugin Manager
 
if [ ! -d "$HOME/.tmux/plugins/tpm" ]
then
    echo "Installing tmux plugin manager"
    git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
    tmux source-file ~/.tmux.conf
fi


SCRIPTPATH=$( cd $(dirname $0) ; pwd -P )

echo "Installing config files from $SCRIPTPATH to $HOME"

#Takes the file to install as an argument
function installfile {
if [ "$#" == 1 ]
then
    if { [ ! -e "$HOME/$1" ] || [ -L "$HOME/$1" ]; } && [ -e "$SCRIPTPATH/$1" ]
    then 
        if [ -L "$HOME/$1" ]
        then
            rm "$HOME/$1"
            msg="$1 updated"
        else
            msg="$1 installed"
        fi
        ln -s "$SCRIPTPATH/$1" "$HOME/$1"
        echo "$msg"
    else
	    echo "not installed: $1"
    fi
fi
}

function installfileinfolder {
if [ "$#" == 2 ]
then
    if [ ! -d "$HOME/$1" ] && [ -e "$SCRIPTPATH/$1" ]
    then
        mkdir -p "$1"
    fi
    installfile "$1/$2"
fi
}

function installallinfolder {
if [ "$#" == 1 ]
then
    pth="$1/*"
    for i in $pth
    do
        if [ -f "$i" ]
        then
            file=$(basename "$i")
            dir=$(dirname "$i")
            installfileinfolder "$dir" "$file"
        fi
    done
fi

}

## Install all in Confs/ dir to home
shopt -s dotglob
for f in *
do
    if [ -f "$f" ] && [[ ! "$f" == install ]] && [[ ! "$f" == README.md ]]
    then
        installfile "$f"
    else
	    echo "not installing $f"
    fi
done

## Install scripts

installallinfolder "Documents/Scripts"
installallinfolder "Documents/Scripts/ctrl"
installallinfolder "Documents/Scripts/internet"
